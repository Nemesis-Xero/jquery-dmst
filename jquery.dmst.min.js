!function(e){function t(t,n){var s={};return t&&"object"==e.type(t)&&(n&&"object"==e.type(n)?(e.each(t,function(e,t){n[e]||(s[e]=t)}),e.each(n,function(e,n){t[e]||(s[e]=n)})):s=e.extend({},t)),s}e.nu||(e.nu={}),e.nu.dmstJqueryIntegration!==!1&&(e.nu.dmstJqueryIntegration=!0),e.nu.dmstJqueryIntegration&&(e.nu.dmstDataName="dmst-instance",e.fn.dmst=function(t,n){t||(t=""),n||(n={});var s=e(this).data(e.nu.dmstDataName);switch(t){case"get-selected":if(s){var i=s.getSelectedValues();return i}return null;case"get-selected-pairs":return s?s.getSelectedNameValuePairs():null;case"set-selected":s&&n.values&&s.setSelectedValues(n.values);break;case"reset":s&&s.reset();break;case"create":default:var a={container:this},l=e.extend(n,a),o=e.nu.dmst(l);e(this).data(e.nu.dmstDataName,o)}}),e.nu.dmst=function(t){var s=e.extend({},n,t);return s.init(),s};var n={distinctOptions:!0,nonValue:{name:"None",value:"-1"},selectBoxClass:"dmstSelect",customSelectBoxClass:"",container:null,baseSelectOptions:null,baseSelect:null,funcLoadOptions:null,init:function(){var t=[e("<option>",{value:this.nonValue.value,text:this.nonValue.name})];this.funcLoadOptions&&this.funcLoadOptions(this),this.baseSelectOptions&&e.each(this.baseSelectOptions,function(n,s){var i=e("<option>",{value:s,text:n});t.push(i)}),this.baseSelect=e("<select>",{"class":this.selectBoxClass+" "+this.customSelectBoxClass}),e(this.baseSelect).append(t);var n=this;this.baseSelect.on({change:function(){var t=e(this).data("last-chosen-value");n.prune(),t||n.cloneSelect(),e(this).data("last-chosen-value",e(this).find("option:selected").val())}}),this.cloneSelect()},getSelectedValues:function(){var t=this,n=this.nonValue.value,s=[];return e(this.container).find("."+this.selectBoxClass).each(function(e,i){var a=t.getSelectedValue(i);a&&a!=n&&s.push(a)}),s},getSelectedNameValuePairs:function(){var t=this,n={};return this.getAllSelectBoxes().each(function(s,i){var a=t.getSelectedOption(i),l=e(a).val();l&&l!=t.nonValue.value&&(n[e(a).text()]=l)}),n},setSelectedValues:function(t){var n=this;e.each(t,function(e,t){n.selectNewValue(t)}),this.prune()},reset:function(){this.getAllSelectBoxes().val(this.nonValue.value),this.prune()},prune:function(){var t="."+this.selectBoxClass;if(this.distinctOptions&&this.baseSelectOptions.length==this.getSelectedValues().length||(t+=":not(:last-child)"),t+=' option[value="'+this.nonValue.value+'"]:selected',e(this.container).find(t).each(function(t,n){e(n).parent().remove()}),this.distinctOptions){var n=this;this.getAllSelectBoxes().each(function(e,t){n.normalizeOptions(t),n.sortOptionsByValue(t)})}},cloneSelect:function(){var t=e(this.baseSelect).clone(!0,!0);this.normalizeOptions(t),e(this.container).append(t)},addOption:function(t,n,s){if(e(t).find('option[value="'+s+'"]').length<1){var i=e("<option>",{value:s,text:n});e(t).append(i)}},normalizeOptions:function(n,s){if(this.distinctOptions){s||(s=this.getSelectedValues()),this.removeOptionsFromElement(n,s);var i=t(this.baseSelectOptions,this.getSelectedNameValuePairs()),a={};this.getAllOptions(n).each(function(t,n){a[e(n).text()]=e(n).val()});var l=t(i,a);l[this.nonValue.name]&&delete l[this.nonValue.name];var o=this;e.each(l,function(e,t){o.addOption(n,e,t)}),this.sortOptionsByValue(n)}},removeOptionsFromElement:function(t,n){this.getUnselectedOptions(t).each(function(t,s){-1!=e.inArray(e(s).val(),n)&&e(s).remove()})},selectNewValue:function(e){this.getLastSelectBox().val(e)},sortOptionsByText:function(t){var n=this.getAllOptions(t).sort(function(t,n){return e(t).text().toLowerCase().localeCompare(e(n).text().toLowerCase())});this.getUnselectedOptions(t).remove(),e(t).append(n)},sortOptionsByValue:function(t){var n=this.getAllOptions(t).sort(function(t,n){return e(t).val()>e(n).val()});this.getUnselectedOptions(t).remove(),e(t).append(n)},getAllSelectBoxes:function(){return e(this.container).find("."+this.selectBoxClass)},getLastSelectBox:function(){return this.getAllSelectBoxes().filter(":last-child")},getSelectedOption:function(t){return e(t).find("option:selected")},getAllOptions:function(t){return e(t).find("option")},getUnselectedOptions:function(t){return e(t).find("option:not(:selected)")},getSelectedValue:function(t){return e(t).find("option:selected").val()}}}(jQuery);
